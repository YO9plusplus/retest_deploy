name: Deploy to Vercel
on:
  # This section defines a manual trigger button in the GitHub Actions tab.
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for manual deployment'
        required: false
        default: 'Manual trigger via GitHub Actions UI'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        # This step is standard for installing dependencies, requiring package-lock.json
        run: npm ci

      - name: Deploy to Vercel (Production)
        # Environment variables are correctly defined here using the GitHub Secrets syntax
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
        run: |
          # 1. Install Vercel CLI globally
          npm install --global vercel

          # 2. Pull Vercel environment variables and project configuration
          # The token is passed to authenticate the CLI command
          vercel pull --yes --environment=production --token=$VERCEL_TOKEN

          # 3. Build the project (using the configuration pulled in the previous step)
          vercel build --prod --token=$VERCEL_TOKEN

          # 4. Deploy the pre-built output to production
          vercel deploy --prebuilt --prod --token=$VERCEL_TOKEN
